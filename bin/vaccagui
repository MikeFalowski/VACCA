#!/bin/sh

# VACuum Control Application for ALBA
# Usage:
#    vaccagui [CONFIG] ; tries to open config file with absolute path or relative to the vacca module.
#
# With no argument the file default.py or TANGO_HOST.py will be launched as config
#
# The VACCA_PATH environment variable should be used to set the path to vacca modules
# To use vacca widgets in other GUI's, both vacca and vaccagui modules must be in PYTHONPATH

# NOTE: It's better to not modify this file to allow setup.py to work properly, 
# to write your custom launcher better copy it to vaccagui.sh and continue editing there.

# S.Rubio-Manrique, srubio@cells.es, 2006-2015

#Source your own environment variables from here:
#source alba_blissrc


echo "Usage: vaccagui [CONFIG.py]"

if [ "echo $HOSTNAME | grep controls02" ] ; then
    export TANGO_HOST="$(tango_host_chooser.sh)"
fi

if [ "$1" ] ; then
    export VACCA_CONFIG="$1"
else
    export VACCA_CONFIG=$VACCA_CONFIG
fi

if [ ! "$VACCA_PATH" ] ; then
    #Getting current script folder
    export VACCA_PATH=$(python -c "import imp;print(imp.find_module('vacca')[1]+'/../')")
    echo "VACCA_PATH environment variable not set, trying $VACCA_PATH instead ..."
fi

#Exporting the folder for config files
if [ ! "$VACCA_DIR" ] ; then
    #     export WORKING_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )/../"
    if [ "$WORKING_DIR" ] ; then
      #For compatibility with old vacca launchers/scripts
      export VACCA_DIR=$WORKING_DIR
    else
      export VACCA_DIR=$(python -c "import fandango as f;f.printf(f.get_database().get_property('VACCA','VACCA_DIR').values()[0][0])")
    fi
fi
export PYTHONPATH=$VACCA_PATH:$PYTHONPATH

#launcher, may use taurusgui or vacca_run (that strips must of taurusgui application setup)
echo "$VACCA_DIR/bin/vacca_run.py"
cd $VACCA_DIR
#taurusgui --taurus-log-level=DEBUG vaccagui &
python bin/vacca_run.py
