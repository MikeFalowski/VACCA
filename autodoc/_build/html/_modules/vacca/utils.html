<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>vacca.utils &mdash; vacca  documentation</title>
    
    <link rel="stylesheet" href="../../_static/agogo.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="vacca  documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" /> 
  </head>
  <body>
    <div class="header-wrapper">
      <div class="header">
        <div class="headertitle"><a
          href="../../index.html">vacca  documentation</a></div>
        <div class="rel">
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a>
        </div>
       </div>
    </div>

    <div class="content-wrapper">
      <div class="content">
        <div class="document">
            
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for vacca.utils</h1><div class="highlight"><pre>
<span class="c">#!/usr/bin/env python</span>

<span class="c">#############################################################################</span>
<span class="c">##</span>
<span class="c">## This file is part of Taurus, a Tango User Interface Library</span>
<span class="c">## </span>
<span class="c">## http://www.tango-controls.org/static/taurus/latest/doc/html/index.html</span>
<span class="c">##</span>
<span class="c">## Copyright 2011 CELLS / ALBA Synchrotron, Bellaterra, Spain</span>
<span class="c">## </span>
<span class="c">## Taurus is free software: you can redistribute it and/or modify</span>
<span class="c">## it under the terms of the GNU Lesser General Public License as published by</span>
<span class="c">## the Free Software Foundation, either version 3 of the License, or</span>
<span class="c">## (at your option) any later version.</span>
<span class="c">## </span>
<span class="c">## Taurus is distributed in the hope that it will be useful,</span>
<span class="c">## but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c">## MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c">## GNU Lesser General Public License for more details.</span>
<span class="c">## </span>
<span class="c">## You should have received a copy of the GNU Lesser General Public License</span>
<span class="c">## along with Taurus.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<span class="c">##</span>
<span class="c">#############################################################################</span>

<span class="n">__doc__</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;vacca.utils python module, by srubio@cells.es</span>

<span class="s">vacca.utils contains several methods and classes for:</span>
<span class="s"> </span>
<span class="s"> - loading config files</span>
<span class="s"> - manipulate Qt color palettes</span>
<span class="s"> - custom Taurus event filters</span>
<span class="s"> </span>
<span class="s">This file is part of Tango Control System</span>
<span class="s">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span><span class="nn">sys</span><span class="o">,</span><span class="nn">traceback</span><span class="o">,</span><span class="nn">imp</span><span class="o">,</span><span class="nn">time</span>
<span class="kn">import</span> <span class="nn">fandango</span>
<span class="kn">from</span> <span class="nn">fandango.qt</span> <span class="kn">import</span> <span class="n">Qt</span>
<span class="kn">from</span> <span class="nn">taurus.qt.qtgui.base</span> <span class="kn">import</span> <span class="n">TaurusBaseComponent</span>
<span class="kn">from</span> <span class="nn">taurus.core.util.eventfilters</span> <span class="kn">import</span> <span class="n">ONLY_CHANGE_AND_PERIODIC</span>
<span class="kn">from</span> <span class="nn">taurus.qt.qtgui.taurusgui.utils</span> <span class="kn">import</span> <span class="n">PanelDescription</span>

<span class="n">DB_HOST</span> <span class="o">=</span> <span class="n">fandango</span><span class="o">.</span><span class="n">tango</span><span class="o">.</span><span class="n">get_tango_host</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">VACCA_PATH</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;VACCA_PATH&#39;</span><span class="p">,</span> <span class="n">imp</span><span class="o">.</span><span class="n">find_module</span><span class="p">(</span><span class="s">&#39;vacca&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">WORKING_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;WORKING_DIR&#39;</span><span class="p">,</span> <span class="n">VACCA_PATH</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">WORKING_DIR</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">):</span> <span class="n">WORKING_DIR</span> <span class="o">+=</span> <span class="s">&#39;/&#39;</span>
<span class="n">DEFAULT_PATH</span> <span class="o">=</span>  <span class="n">WORKING_DIR</span> <span class="c">#&#39;/homelocal/sicilia/applications/vacca/&#39;</span>
<span class="n">wdir</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">WORKING_DIR</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
<span class="n">vpath</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">VACCA_PATH</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>

<div class="viewcode-block" id="get_config_file"><a class="viewcode-back" href="../../vacca.utils.html#vacca.utils.get_config_file">[docs]</a><span class="k">def</span> <span class="nf">get_config_file</span><span class="p">():</span>
    <span class="c">#CONFIG_FILE sys.argv[-1] if fandango.matchCl(&#39;^[^-].*py$&#39;,sys.argv[-1]) else</span>
    <span class="n">CONFIG_FILE</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s">&#39;VACCA_CONFIG&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="s">&#39;&#39;</span><span class="c"># or DB_HOST+&#39;.py&#39;</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;get_config_file(</span><span class="si">%s</span><span class="s">)&#39;</span><span class="o">%</span><span class="n">CONFIG_FILE</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">CONFIG_FILE</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">):</span>
        <span class="n">CONFIG_FILE</span> <span class="o">=</span> <span class="n">DEFAULT_PATH</span><span class="o">+</span><span class="n">CONFIG_FILE</span>
        
    <span class="k">if</span> <span class="ow">not</span> <span class="n">fandango</span><span class="o">.</span><span class="n">linos</span><span class="o">.</span><span class="n">file_exists</span><span class="p">(</span><span class="n">CONFIG_FILE</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">fandango</span><span class="o">.</span><span class="n">linos</span><span class="o">.</span><span class="n">file_exists</span><span class="p">(</span><span class="n">CONFIG_FILE</span><span class="o">+</span><span class="s">&#39;.py&#39;</span><span class="p">):</span>
            <span class="n">CONFIG_FILE</span> <span class="o">+=</span> <span class="s">&#39;.py&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;WARNING: </span><span class="si">%s</span><span class="s"> config file not found!&#39;</span><span class="o">%</span><span class="n">CONFIG_FILE</span><span class="p">)</span>
            <span class="k">return</span>

    <span class="k">print</span> <span class="s">&#39;VaccaGUI: Loading </span><span class="si">%s</span><span class="s"> ...&#39;</span> <span class="o">%</span> <span class="n">CONFIG_FILE</span>
    <span class="k">try</span><span class="p">:</span> 
        <span class="n">CONFIG</span> <span class="o">=</span> <span class="nb">globals</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">CONFIG_FILE</span><span class="p">,</span><span class="n">fandango</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">loadModule</span><span class="p">(</span><span class="n">CONFIG_FILE</span><span class="p">))</span>
        <span class="c">#print &#39;\n&#39;.join(sorted(&#39;\t%s:\t%s&#39;%(k,getattr(CONFIG,k)) for k in dir(CONFIG) if not k.startswith(&#39;_&#39;)))</span>
    <span class="k">except</span><span class="p">:</span> 
        <span class="k">print</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span><span class="s">&#39;Unable to load </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">CONFIG_FILE</span>
    <span class="k">return</span> <span class="n">CONFIG</span>
</div>
<div class="viewcode-block" id="get_shared_data_manager"><a class="viewcode-back" href="../../vacca.utils.html#vacca.utils.get_shared_data_manager">[docs]</a><span class="k">def</span> <span class="nf">get_shared_data_manager</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    sdm = get_shared_data_manager() #Qt.qApp.SDM Singletone</span>
<span class="sd">    sdm.connectReader(&#39;channelName&#39;,objectInstance.method,readOnConnect=False) #Using instantiated object/function instead of names!!</span>
<span class="sd">    sdm.connectWriter(&#39;SelectedInstrument&#39;,out_hook,&#39;modelChanged&#39;) #&#39;Channel&#39;, object, &#39;qt signal name&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Qt</span><span class="o">.</span><span class="n">qApp</span><span class="o">.</span><span class="n">SDM</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;Shared Data Manager is not available! (no TaurusGUI instance?)&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">None</span>
    </div>
<div class="viewcode-block" id="get_shared_data_signals"><a class="viewcode-back" href="../../vacca.utils.html#vacca.utils.get_shared_data_signals">[docs]</a><span class="k">def</span> <span class="nf">get_shared_data_signals</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">sdm</span> <span class="o">=</span> <span class="n">get_shared_data_manager</span><span class="p">()</span>
        <span class="n">signals</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">sdm</span><span class="o">.</span><span class="n">_SharedDataManager__models</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">signals</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;readers&#39;</span><span class="p">:[],</span><span class="s">&#39;writers&#39;</span><span class="p">:[]}</span>
            <span class="k">for</span> <span class="n">o</span><span class="p">,</span><span class="n">s</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">_DataModel__readerSlots</span><span class="p">:</span>
                <span class="n">signals</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s">&#39;readers&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">o</span><span class="p">(),</span><span class="n">s</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">o</span><span class="p">,</span><span class="n">s</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">_DataModel__writerSignals</span><span class="p">:</span>
                <span class="n">signals</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s">&#39;writers&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">o</span><span class="p">(),</span><span class="n">s</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">signals</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">{}</span>
                
<span class="c">###############################################################################</span>
<span class="c"># Methods for managing palettes</span>
    </div>
<div class="viewcode-block" id="get_solid_brush"><a class="viewcode-back" href="../../vacca.utils.html#vacca.utils.get_solid_brush">[docs]</a><span class="k">def</span> <span class="nf">get_solid_brush</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">pattern</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">taurus.external.qt</span> <span class="kn">import</span> <span class="n">Qt</span>
    <span class="n">brush</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QBrush</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">QColor</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
    <span class="n">brush</span><span class="o">.</span><span class="n">setStyle</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">SolidPattern</span> <span class="k">if</span> <span class="n">pattern</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">pattern</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">brush</span>
</div>
<div class="viewcode-block" id="get_White_palette"><a class="viewcode-back" href="../../vacca.utils.html#vacca.utils.get_White_palette">[docs]</a><span class="k">def</span> <span class="nf">get_White_palette</span><span class="p">(</span><span class="n">palette</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">taurus.external.qt</span> <span class="kn">import</span> <span class="n">Qt</span>
    <span class="k">if</span> <span class="n">palette</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">palette</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QPalette</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">QPalette</span><span class="o">.</span><span class="n">Base</span><span class="p">,</span><span class="n">Qt</span><span class="o">.</span><span class="n">QPalette</span><span class="o">.</span><span class="n">Window</span><span class="p">):</span> <span class="c">#QtGui.QPalette.BrightText,QtGui.QPalette.ButtonText,Qt.QPalette.Button</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">QPalette</span><span class="o">.</span><span class="n">Active</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QPalette</span><span class="o">.</span><span class="n">Inactive</span><span class="p">,</span>
                  <span class="n">Qt</span><span class="o">.</span><span class="n">QPalette</span><span class="o">.</span><span class="n">Disabled</span><span class="p">):</span>
            <span class="n">palette</span><span class="o">.</span><span class="n">setBrush</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">get_solid_brush</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">palette</span>
    </div>
<div class="viewcode-block" id="get_halfWhite_palette"><a class="viewcode-back" href="../../vacca.utils.html#vacca.utils.get_halfWhite_palette">[docs]</a><span class="k">def</span> <span class="nf">get_halfWhite_palette</span><span class="p">(</span><span class="n">palette</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">taurus.external.qt</span> <span class="kn">import</span> <span class="n">Qt</span>
    <span class="k">if</span> <span class="n">palette</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">palette</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QPalette</span><span class="p">()</span>
    <span class="n">palette</span><span class="o">.</span><span class="n">setBrush</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">QPalette</span><span class="o">.</span><span class="n">Active</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QPalette</span><span class="o">.</span><span class="n">Button</span><span class="p">,</span>
                     <span class="n">get_solid_brush</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">))</span>
    <span class="n">palette</span><span class="o">.</span><span class="n">setBrush</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">QPalette</span><span class="o">.</span><span class="n">Inactive</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QPalette</span><span class="o">.</span><span class="n">Button</span><span class="p">,</span>
                     <span class="n">get_solid_brush</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">))</span>
    <span class="n">palette</span><span class="o">.</span><span class="n">setBrush</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">QPalette</span><span class="o">.</span><span class="n">Disabled</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QPalette</span><span class="o">.</span><span class="n">Button</span><span class="p">,</span>
                     <span class="n">get_solid_brush</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">palette</span>
</div>
<div class="viewcode-block" id="get_fullWhite_palette"><a class="viewcode-back" href="../../vacca.utils.html#vacca.utils.get_fullWhite_palette">[docs]</a><span class="k">def</span> <span class="nf">get_fullWhite_palette</span><span class="p">(</span><span class="n">palette</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">taurus.external.qt</span> <span class="kn">import</span> <span class="n">Qt</span>
    <span class="k">if</span> <span class="n">palette</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">palette</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QPalette</span><span class="p">()</span>
    <span class="n">palette</span> <span class="o">=</span> <span class="n">get_halfWhite_palette</span><span class="p">(</span><span class="n">palette</span><span class="p">)</span>
    <span class="n">palette</span> <span class="o">=</span> <span class="n">get_White_palette</span><span class="p">(</span><span class="n">palette</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">palette</span>

<span class="c">###############################################################################</span>
<span class="c"># Methods for using Taurus Event Filters</span>
</div>
<span class="kn">import</span> <span class="nn">fandango</span> <span class="kn">as</span> <span class="nn">f</span>

<div class="viewcode-block" id="EventFilter"><a class="viewcode-back" href="../../vacca.utils.html#vacca.utils.EventFilter">[docs]</a><span class="k">class</span> <span class="nc">EventFilter</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">condition</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">condition</span> <span class="o">=</span> <span class="n">condition</span>
    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">v</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">condition</span><span class="p">()</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">isCallable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">condition</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">condition</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">s</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">v</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
</div>
<div class="viewcode-block" id="EventCounter"><a class="viewcode-back" href="../../vacca.utils.html#vacca.utils.EventCounter">[docs]</a><span class="k">class</span> <span class="nc">EventCounter</span><span class="p">(</span><span class="n">EventFilter</span><span class="p">):</span>
    <span class="nd">@f.Catched</span>
    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">v</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span> <span class="n">src</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">getFullName</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span> <span class="n">src</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&#39;counts&#39;</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">counts</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">counts</span><span class="p">[</span><span class="n">src</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">s</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">v</span>
        </div>
<div class="viewcode-block" id="OnChangeOrTimeEventFilter"><a class="viewcode-back" href="../../vacca.utils.html#vacca.utils.OnChangeOrTimeEventFilter">[docs]</a><span class="k">class</span> <span class="nc">OnChangeOrTimeEventFilter</span><span class="p">(</span><span class="n">EventFilter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The instances of this class will be callables that can be used as filters</span>
<span class="sd">    of repeated-value events.</span>
<span class="sd">    If the event type is Change or Periodic, it will only pass when its</span>
<span class="sd">    evt_value.value is different from that of the last event received from the</span>
<span class="sd">    same source and type. If evt_value.value is not available in the current</span>
<span class="sd">    event, the whole evt_value is used for comparison and as a future reference.</span>
<span class="sd">    But!, if setMaxDeltaTime is set, then any event that occurred more than Delta Time seconds </span>
<span class="sd">    after the last one will be allowed to pass through the chain.</span>
<span class="sd">    </span>

<span class="sd">    This is useful to avoid processing repetitive events.</span>

<span class="sd">    Note that you cannot use this class as a filter: you need to use an</span>
<span class="sd">    instance of it.</span>

<span class="sd">    Note 2: Use a different instance each time you insert this filter</span>
<span class="sd">    into a different widget unless you *really* know what you are doing.</span>

<span class="sd">    Example of usage::</span>
<span class="sd">        evf = OnChangeOrTimeEventFilter()</span>
<span class="sd">        evf.setDeltaTime(60.)</span>
<span class="sd">        filters = [evf, IGNORE_CONFIG]</span>
<span class="sd">        MyTaurusComponentInstance.setEventFilters(filters,preqt=True)</span>
<span class="sd">        filterEvent(s, t, v, filters)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lastValues</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lastTimes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deltaValue</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deltaTime</span> <span class="o">=</span> <span class="mi">0</span>
        
<div class="viewcode-block" id="OnChangeOrTimeEventFilter.setDeltaValue"><a class="viewcode-back" href="../../vacca.utils.html#vacca.utils.OnChangeOrTimeEventFilter.setDeltaValue">[docs]</a>    <span class="k">def</span> <span class="nf">setDeltaValue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">mindiff</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deltaValue</span> <span class="o">=</span> <span class="n">mindiff</span>
        </div>
<div class="viewcode-block" id="OnChangeOrTimeEventFilter.setDeltaTime"><a class="viewcode-back" href="../../vacca.utils.html#vacca.utils.OnChangeOrTimeEventFilter.setDeltaTime">[docs]</a>    <span class="k">def</span> <span class="nf">setDeltaTime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">mindiff</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deltaTime</span> <span class="o">=</span> <span class="n">mindiff</span>
        </div>
    <span class="nd">@f.Catched</span>
    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="c"># restrict this  filter only to change and periodic events.</span>
        <span class="k">if</span> <span class="n">ONLY_CHANGE_AND_PERIODIC</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="k">return</span> <span class="n">s</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">v</span>
        <span class="c"># block event if we recorded one before with same src, type and v.value</span>
        <span class="n">new_value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="s">&#39;value&#39;</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span> <span class="n">new_time</span> <span class="o">=</span> <span class="n">ctime2time</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span> <span class="n">new_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lastValues</span><span class="p">[(</span><span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">)]</span> <span class="o">==</span> <span class="n">new_value</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">deltaTime</span> <span class="ow">or</span> <span class="n">new_time</span><span class="o">&lt;</span><span class="bp">self</span><span class="o">.</span><span class="n">_lastTimes</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">deltaTime</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">None</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span> <span class="k">pass</span>
        <span class="c"># if it was&#39;t blocked, store src, type and v.value for future checks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lastValues</span><span class="p">[(</span><span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">)]</span> <span class="o">=</span>  <span class="n">new_value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lastTimes</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_time</span>
        <span class="k">return</span> <span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">v</span>
    
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">__test__</span><span class="p">():</span>
        <span class="kn">import</span> <span class="nn">taurus</span><span class="o">,</span><span class="nn">time</span>
        <span class="kn">from</span> <span class="nn">vacca.utils</span> <span class="kn">import</span> <span class="n">EventFilter</span><span class="p">,</span><span class="n">EventCounter</span><span class="p">,</span><span class="n">OnChangeOrTimeEventFilter</span><span class="p">,</span><span class="n">MyTaurusComponent</span>
        <span class="n">tbc</span> <span class="o">=</span> <span class="n">MyTaurusComponent</span><span class="p">(</span><span class="s">&#39;test&#39;</span><span class="p">)</span>
        <span class="n">attr1</span><span class="p">,</span><span class="n">attr2</span> <span class="o">=</span> <span class="s">&#39;test/sim/tonto/temperature&#39;</span><span class="p">,</span><span class="s">&#39;test/sim/tonto/temperate&#39;</span>
        <span class="n">tbc</span><span class="o">.</span><span class="n">setMyHandler</span><span class="p">(</span><span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span><span class="n">fandango</span><span class="o">.</span><span class="n">printf</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span>
                    <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">ctime</span><span class="p">(),</span><span class="nb">getattr</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="s">&#39;value&#39;</span><span class="p">,</span><span class="n">args</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span>
                    <span class="n">taurus</span><span class="o">.</span><span class="n">Attribute</span><span class="p">(</span><span class="n">attr2</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">value</span><span class="p">))))</span>
        <span class="n">evf</span> <span class="o">=</span> <span class="n">OnChangeOrTimeEventFilter</span><span class="p">()</span>
        <span class="n">evf</span><span class="o">.</span><span class="n">setDeltaTime</span><span class="p">(</span><span class="mf">10.</span><span class="p">)</span>
        <span class="n">tbc</span><span class="o">.</span><span class="n">setEventFilters</span><span class="p">((</span><span class="n">evf</span><span class="p">,))</span>
        <span class="n">tbc</span><span class="o">.</span><span class="n">setEventBufferPeriod</span><span class="p">(</span><span class="mf">3.</span><span class="p">)</span>
        <span class="n">tbc</span><span class="o">.</span><span class="n">setModel</span><span class="p">(</span><span class="n">attr1</span><span class="p">)</span>
        <span class="n">ta</span> <span class="o">=</span> <span class="n">tbc</span><span class="o">.</span><span class="n">getModelObj</span><span class="p">()</span>
        <span class="n">ta</span><span class="o">.</span><span class="n">changePollingPeriod</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
        
<span class="c">###############################################################################</span>
<span class="c"># QT Helping Classes</span>
</div>
<span class="kn">from</span> <span class="nn">taurus.qt.qtcore.mimetypes</span> <span class="kn">import</span> <span class="n">TAURUS_ATTR_MIME_TYPE</span><span class="p">,</span> <span class="n">TAURUS_DEV_MIME_TYPE</span><span class="p">,</span> <span class="n">TAURUS_MODEL_MIME_TYPE</span><span class="p">,</span> <span class="n">TAURUS_MODEL_LIST_MIME_TYPE</span>

<div class="viewcode-block" id="WidgetAcceptDrops"><a class="viewcode-back" href="../../vacca.utils.html#vacca.utils.WidgetAcceptDrops">[docs]</a><span class="k">class</span> <span class="nc">WidgetAcceptDrops</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">TAURUS_DEV_MIME_TYPE</span> <span class="o">=</span> <span class="n">TAURUS_DEV_MIME_TYPE</span>
    <span class="n">TAURUS_ATTR_MIME_TYPE</span> <span class="o">=</span> <span class="n">TAURUS_ATTR_MIME_TYPE</span>
    <span class="n">TAURUS_MODEL_MIME_TYPE</span> <span class="o">=</span> <span class="n">TAURUS_MODEL_MIME_TYPE</span>
    <span class="n">TAURUS_MODEL_LIST_MIME_TYPE</span> <span class="o">=</span> <span class="n">TAURUS_MODEL_LIST_MIME_TYPE</span>
    <span class="n">TEXT_MIME_TYPE</span> <span class="o">=</span> <span class="s">&#39;text/plain&#39;</span>
    <span class="n">_supportedMimeTypes</span> <span class="o">=</span> <span class="bp">None</span>
    
<div class="viewcode-block" id="WidgetAcceptDrops.checkDrops"><a class="viewcode-back" href="../../vacca.utils.html#vacca.utils.WidgetAcceptDrops.checkDrops">[docs]</a>    <span class="k">def</span> <span class="nf">checkDrops</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
        <span class="k">try</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">setAcceptDrops</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span> <span class="k">pass</span></div>
<div class="viewcode-block" id="WidgetAcceptDrops.getSupportedMimeTypes"><a class="viewcode-back" href="../../vacca.utils.html#vacca.utils.WidgetAcceptDrops.getSupportedMimeTypes">[docs]</a>    <span class="k">def</span> <span class="nf">getSupportedMimeTypes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">checkDrops</span><span class="p">()</span> 
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_supportedMimeTypes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_supportedMimeTypes</span>
        <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="p">[</span><span class="n">TEXT</span><span class="p">]</span></div>
<div class="viewcode-block" id="WidgetAcceptDrops.setSupportedMimeTypes"><a class="viewcode-back" href="../../vacca.utils.html#vacca.utils.WidgetAcceptDrops.setSupportedMimeTypes">[docs]</a>    <span class="k">def</span> <span class="nf">setSupportedMimeTypes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">mimes</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_supportedMimeTypes</span> <span class="o">=</span> <span class="n">mimes</span></div>
<div class="viewcode-block" id="WidgetAcceptDrops.setDropEventCallback"><a class="viewcode-back" href="../../vacca.utils.html#vacca.utils.WidgetAcceptDrops.setDropEventCallback">[docs]</a>    <span class="k">def</span> <span class="nf">setDropEventCallback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">callback</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dropeventcallback</span> <span class="o">=</span> <span class="n">callback</span>
        
    <span class="c"># ENABLING DROP OF DEVICE NAMES :</span></div>
<div class="viewcode-block" id="WidgetAcceptDrops.checkSupportedMimeType"><a class="viewcode-back" href="../../vacca.utils.html#vacca.utils.WidgetAcceptDrops.checkSupportedMimeType">[docs]</a>    <span class="k">def</span> <span class="nf">checkSupportedMimeType</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">,</span><span class="n">accept</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span> 
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getSupportedMimeTypes</span><span class="p">()</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">event</span><span class="o">.</span><span class="n">mimeData</span><span class="p">()</span><span class="o">.</span><span class="n">formats</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">accept</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">acceptProposedAction</span><span class="p">()</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">return</span> <span class="bp">False</span></div>
<div class="viewcode-block" id="WidgetAcceptDrops.dragEnterEvent"><a class="viewcode-back" href="../../vacca.utils.html#vacca.utils.WidgetAcceptDrops.dragEnterEvent">[docs]</a>    <span class="k">def</span> <span class="nf">dragEnterEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkSupportedMimeType</span><span class="p">(</span><span class="n">event</span><span class="p">,</span><span class="n">accept</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></div>
<div class="viewcode-block" id="WidgetAcceptDrops.dragMoveEvent"><a class="viewcode-back" href="../../vacca.utils.html#vacca.utils.WidgetAcceptDrops.dragMoveEvent">[docs]</a>    <span class="k">def</span> <span class="nf">dragMoveEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span> <span class="n">event</span><span class="o">.</span><span class="n">acceptProposedAction</span><span class="p">()</span>
            </div>
<div class="viewcode-block" id="WidgetAcceptDrops.dropEvent"><a class="viewcode-back" href="../../vacca.utils.html#vacca.utils.WidgetAcceptDrops.dropEvent">[docs]</a>    <span class="k">def</span> <span class="nf">dropEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;reimplemented to support drag&amp;drop of models. See :class:`QWidget`&#39;&#39;&#39;</span>
        <span class="k">print</span> <span class="s">&#39;In dropEvent&#39;</span><span class="p">,</span><span class="n">event</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getSupportedMimeTypes</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">t</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">mimeData</span><span class="p">()</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                        <span class="k">print</span> <span class="n">t</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_dropeventcallback</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
                        <span class="k">return</span>
                <span class="k">except</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">warning_exc</span><span class="p">())</span>
            <span class="k">except</span><span class="p">:</span> <span class="k">pass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;Invalid data (</span><span class="si">%s</span><span class="s">) for MIMETYPE&#39;</span><span class="o">%</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">d</span><span class="p">)))</span>
        <span class="n">event</span><span class="o">.</span><span class="n">acceptProposedAction</span><span class="p">()</span>
        </div></div>
<div class="viewcode-block" id="Draggable"><a class="viewcode-back" href="../../vacca.utils.html#vacca.utils.Draggable">[docs]</a><span class="k">class</span> <span class="nc">Draggable</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_drageventcallback</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">s</span><span class="o">=</span><span class="bp">self</span><span class="p">:</span><span class="n">s</span><span class="o">.</span><span class="n">text</span><span class="p">()</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="s">&#39;text&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="s">&#39;&#39;</span>
    
<div class="viewcode-block" id="Draggable.setDragEventCallback"><a class="viewcode-back" href="../../vacca.utils.html#vacca.utils.Draggable.setDragEventCallback">[docs]</a>    <span class="k">def</span> <span class="nf">setDragEventCallback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">hook</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_drageventcallback</span> <span class="o">=</span> <span class="n">hook</span>
    </div>
<div class="viewcode-block" id="Draggable.mousePressEvent"><a class="viewcode-back" href="../../vacca.utils.html#vacca.utils.Draggable.mousePressEvent">[docs]</a>    <span class="k">def</span> <span class="nf">mousePressEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;reimplemented to provide drag events&#39;&#39;&#39;</span>
        <span class="k">print</span> <span class="s">&#39;In DefaultLabelWidget.mousePressEvent&#39;</span>
        <span class="n">Qt</span><span class="o">.</span><span class="n">QLabel</span><span class="o">.</span><span class="n">mousePressEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">button</span><span class="p">()</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dragStartPosition</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">pos</span><span class="p">()</span>
            </div>
<div class="viewcode-block" id="Draggable.mouseMoveEvent"><a class="viewcode-back" href="../../vacca.utils.html#vacca.utils.Draggable.mouseMoveEvent">[docs]</a>    <span class="k">def</span> <span class="nf">mouseMoveEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;reimplemented to provide drag events&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">event</span><span class="o">.</span><span class="n">buttons</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">mimeData</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QMimeData</span><span class="p">()</span>
        <span class="n">txt</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_drageventcallback</span><span class="p">())</span>
        <span class="k">print</span> <span class="s">&#39;Draggable.mouseMoveEvent&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_drageventcallback</span><span class="p">,</span><span class="n">txt</span>
        <span class="n">mimeData</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>
        <span class="n">drag</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QDrag</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">drag</span><span class="o">.</span><span class="n">setMimeData</span><span class="p">(</span><span class="n">mimeData</span><span class="p">)</span>
        <span class="n">drag</span><span class="o">.</span><span class="n">setHotSpot</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">pos</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">rect</span><span class="p">()</span><span class="o">.</span><span class="n">topLeft</span><span class="p">())</span>
        <span class="n">dropAction</span> <span class="o">=</span> <span class="n">drag</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">CopyAction</span><span class="p">)</span>
    </div></div>
<div class="viewcode-block" id="DraggableLabel"><a class="viewcode-back" href="../../vacca.utils.html#vacca.utils.DraggableLabel">[docs]</a><span class="k">class</span> <span class="nc">DraggableLabel</span><span class="p">(</span><span class="n">Draggable</span><span class="p">,</span><span class="n">Qt</span><span class="o">.</span><span class="n">QLabel</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="n">Qt</span><span class="o">.</span><span class="n">QLabel</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">text</span><span class="p">)</span>
        <span class="n">Draggable</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="MyTaurusComponent"><a class="viewcode-back" href="../../vacca.utils.html#vacca.utils.MyTaurusComponent">[docs]</a><span class="k">class</span> <span class="nc">MyTaurusComponent</span><span class="p">(</span><span class="n">TaurusBaseComponent</span><span class="p">,</span><span class="n">Qt</span><span class="o">.</span><span class="n">QObject</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;test&#39;</span><span class="p">):</span>
        <span class="n">Qt</span><span class="o">.</span><span class="n">QObject</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">TaurusBaseComponent</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">my_handler</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">printf</span>
        
<div class="viewcode-block" id="MyTaurusComponent.fireEvent"><a class="viewcode-back" href="../../vacca.utils.html#vacca.utils.MyTaurusComponent.fireEvent">[docs]</a>    <span class="k">def</span> <span class="nf">fireEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt_src</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">evt_type</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">evt_value</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eventBufferPeriod</span><span class="p">:</span>
            <span class="c"># If we have an active event buffer delay, store the event...</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eventsBufferLock</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_bufferedEvents</span><span class="p">[(</span><span class="n">evt_src</span><span class="p">,</span> <span class="n">evt_type</span><span class="p">)]</span> <span class="o">=</span>  <span class="p">(</span><span class="n">evt_src</span><span class="p">,</span> <span class="n">evt_type</span><span class="p">,</span> 
                                                              <span class="n">evt_value</span><span class="p">)</span> 
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># if we are not buffering, directly emit the signal</span>
            <span class="k">try</span><span class="p">:</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">getSignaller</span><span class="p">()</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">SIGNAL</span><span class="p">(</span><span class="s">&#39;taurusEvent&#39;</span><span class="p">),</span> <span class="n">evt_src</span><span class="p">,</span> <span class="n">evt_type</span><span class="p">,</span> <span class="n">evt_value</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span> 
                <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">.fireEvent(...) failed!&#39;</span><span class="o">%</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">getLastException</span><span class="p">())</span>
</div>
<div class="viewcode-block" id="MyTaurusComponent.setMyHandler"><a class="viewcode-back" href="../../vacca.utils.html#vacca.utils.MyTaurusComponent.setMyHandler">[docs]</a>    <span class="k">def</span> <span class="nf">setMyHandler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">handler</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">my_handler</span> <span class="o">=</span> <span class="n">handler</span>                </div>
    <span class="nd">@f.Catched</span>
<div class="viewcode-block" id="MyTaurusComponent.handleEvent"><a class="viewcode-back" href="../../vacca.utils.html#vacca.utils.MyTaurusComponent.handleEvent">[docs]</a>    <span class="k">def</span> <span class="nf">handleEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="c">#self.error(&#39;in handleEvent(%s,%s)&#39;%(str(args[0]),len(args)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">my_handler</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
        </div></div>
<div class="viewcode-block" id="addCustomPanel2Gui"><a class="viewcode-back" href="../../vacca.utils.html#vacca.utils.addCustomPanel2Gui">[docs]</a><span class="k">class</span> <span class="nc">addCustomPanel2Gui</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    this Class is used to add new panel to existing TaurusGUI with</span>
<span class="sd">    the same Context.</span>
<span class="sd">    Each extra_panel class should have a &#39;getPaneldescription&#39; and</span>
<span class="sd">    getDefaultIcon methods.</span>
<span class="sd">    </span>
<span class="sd">    Pass a dictionary like this:</span>
<span class="sd">       EXTRA_PANELS[&#39;VaccaProperties&#39;] = {</span>
<span class="sd">        &#39;class&#39;: vacca.VaccaPropTable,</span>
<span class="sd">        &#39;icon&#39;: &#39;:/places/network-server.svg&#39;,</span>
<span class="sd">        }</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extra_panels</span><span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">&#39;&gt;&gt;&#39;</span><span class="o">*</span><span class="mi">80</span>
        <span class="k">print</span> <span class="s">&#39;&gt;&gt;&#39;</span><span class="o">*</span><span class="mi">80</span>
        <span class="k">print</span> <span class="s">&#39;&gt;&gt;&#39;</span><span class="o">*</span><span class="mi">80</span>
        <span class="kn">from</span> <span class="nn">taurus.external.qt</span> <span class="kn">import</span> <span class="n">QtGui</span>
        <span class="kn">from</span> <span class="nn">vacca.utils</span> <span class="kn">import</span> <span class="n">WORKING_DIR</span>

        <span class="n">exist_instance</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">app</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QApplication</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
            <span class="k">return</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="c">#find actual Taurusgui Instance</span>
            <span class="k">if</span> <span class="n">app</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">exist_instance</span> <span class="o">=</span> <span class="bp">True</span>

                <span class="n">taurusgui</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="n">widgets</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">allWidgets</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">widget</span> <span class="ow">in</span> <span class="n">widgets</span><span class="p">:</span>
                    <span class="n">widgetType</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">widget</span><span class="p">))</span>
                    <span class="k">if</span> <span class="s">&#39;taurus.qt.qtgui.taurusgui.taurusgui.TaurusGui&#39;</span> <span class="ow">in</span> <span class="n">widgetType</span><span class="p">:</span>
                        <span class="n">taurusgui</span> <span class="o">=</span> <span class="n">widget</span>

                <span class="c">#Launch method</span>
                <span class="k">def</span> <span class="nf">_launchPanel</span><span class="p">(</span><span class="n">panelName</span><span class="p">,</span> <span class="n">panelClass</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
                    <span class="c">#print args</span>
                    <span class="c">#print panelName, panelClass</span>
                    <span class="c">#print &quot;Launch Panel&quot;</span>
                    <span class="k">print</span> <span class="n">exist_instance</span>
                    <span class="k">if</span> <span class="n">exist_instance</span><span class="p">:</span>

                        <span class="n">exist</span> <span class="o">=</span> <span class="bp">False</span>

                        <span class="c">#find if exists instance with this Widget</span>
                        <span class="k">for</span> <span class="n">widget</span> <span class="ow">in</span> <span class="n">app</span><span class="o">.</span><span class="n">allWidgets</span><span class="p">():</span>
                            <span class="n">widgetType</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">widget</span><span class="p">))</span>
                            <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">panelClass</span><span class="p">)</span> <span class="ow">in</span> <span class="n">widgetType</span><span class="p">:</span>

                                <span class="c">#If exist set Flag to know it</span>
                                <span class="n">exist</span> <span class="o">=</span> <span class="bp">True</span>
                                <span class="n">taurusgui</span><span class="o">.</span><span class="n">setFocusToPanel</span><span class="p">(</span><span class="n">panelName</span><span class="p">)</span>
                                <span class="k">break</span>

                        <span class="k">if</span> <span class="ow">not</span> <span class="n">exist</span><span class="p">:</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="n">taurusgui</span><span class="o">.</span><span class="n">createCustomPanel</span><span class="p">(</span><span class="n">panelClass</span><span class="o">.</span><span class="n">getPanelDescription</span><span class="p">(</span><span class="n">panelName</span><span class="p">))</span>
                            <span class="k">except</span><span class="p">:</span>
                                <span class="n">taurusgui</span><span class="o">.</span><span class="n">createCustomPanel</span><span class="p">(</span><span class="n">PanelDescription</span><span class="p">(</span><span class="n">panelName</span><span class="p">,</span><span class="n">panelClass</span><span class="o">.</span><span class="n">__module__</span><span class="o">+</span><span class="s">&#39;.&#39;</span><span class="o">+</span><span class="n">panelClass</span><span class="o">.</span><span class="n">__name__</span><span class="p">))</span>

                <span class="k">def</span> <span class="nf">launchPanel</span><span class="p">(</span><span class="n">panelName</span><span class="p">,</span> <span class="n">panelClass</span><span class="p">):</span>
                    <span class="k">return</span> <span class="k">lambda</span> <span class="n">args</span><span class="p">:</span> <span class="n">_launchPanel</span><span class="p">(</span><span class="n">panelName</span><span class="p">,</span> <span class="n">panelClass</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">panel</span> <span class="ow">in</span> <span class="n">extra_panels</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">class_Panel</span> <span class="o">=</span> <span class="n">extra_panels</span><span class="p">[</span><span class="n">panel</span><span class="p">][</span><span class="s">&#39;class&#39;</span><span class="p">]</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">icon</span> <span class="o">=</span> <span class="n">extra_panels</span><span class="p">[</span><span class="n">panel</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;icon&#39;</span><span class="p">,</span><span class="bp">None</span><span class="p">)</span> <span class="ow">or</span> <span class="n">class_Panel</span><span class="o">.</span><span class="n">getDefaultIcon</span><span class="p">()</span>
                    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
                        <span class="k">print</span><span class="p">(</span><span class="s">&#39;Icon exception in addCustomPanel2Gui: </span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="n">e</span><span class="p">)</span>
                        <span class="n">icon</span> <span class="o">=</span> <span class="s">&#39;:/places/network-server.svg&#39;</span>
                    <span class="n">final_icon_url</span> <span class="o">=</span> <span class="n">icon</span> <span class="k">if</span> <span class="n">fandango</span><span class="o">.</span><span class="n">matchCl</span><span class="p">(</span><span class="s">&#39;^[\:/]&#39;</span><span class="p">,</span><span class="n">icon</span><span class="p">)</span> <span class="k">else</span> <span class="n">wdir</span><span class="p">(</span><span class="s">&#39;vacca/&#39;</span><span class="o">+</span><span class="n">icon</span><span class="p">)</span>
                    <span class="c">#button = TaurusLauncherButton(</span>
                    <span class="c">#    widget=class_Panel.getPanelDescription(panel))</span>
                    <span class="c">#taurusgui.jorgsBar.addWidget(button)</span>
                    <span class="n">action</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QAction</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QIcon</span><span class="p">(</span><span class="n">final_icon_url</span><span class="p">),</span>
                        <span class="n">panel</span><span class="p">,</span> <span class="n">taurusgui</span><span class="p">)</span>
                    <span class="c">#func = launchPanel(panel, class_Panel)</span>
                    <span class="n">func</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">args</span><span class="p">,</span><span class="n">panelName</span><span class="o">=</span><span class="n">panel</span><span class="p">,</span><span class="n">panelClass</span><span class="o">=</span><span class="n">class_Panel</span><span class="p">:</span> \
                        <span class="n">_launchPanel</span><span class="p">(</span><span class="n">panelName</span><span class="p">,</span><span class="n">panelClass</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
                    <span class="n">Qt</span><span class="o">.</span><span class="n">QObject</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">SIGNAL</span><span class="p">(</span><span class="s">&quot;triggered(bool)&quot;</span><span class="p">),</span> <span class="n">func</span><span class="p">)</span>
                    <span class="k">print</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s"> Added in jorgsBar&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">panel</span><span class="p">)</span>
                    <span class="n">taurusgui</span><span class="o">.</span><span class="n">jorgsBar</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
</div>
<span class="kn">from</span> <span class="nn">.doc</span> <span class="kn">import</span> <span class="n">get_autodoc</span>
<span class="n">__doc__</span> <span class="o">=</span> <span class="n">get_autodoc</span><span class="p">(</span><span class="n">__name__</span><span class="p">,</span><span class="nb">vars</span><span class="p">())</span>
</pre></div>

          </div>
        </div>
      </div>
        </div>
        <div class="sidebar">
          <h3>Table Of Contents</h3>
          <ul>
<li class="toctree-l1"><a class="reference internal" href="../../readme.html">Welcome to vacca&#8217;s documentation!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../vacca.html">vacca package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../vacca.config.html">vacca.config module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../vacca.utils.html">vacca.utils module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../vacca.setup.html">vacca.setup module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../vacca.doc.html">vacca.doc module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../vacca.default.html">vacca.default module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../vacca.panel.html">vacca.panel module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../vacca.plot.html">vacca.plot module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../vacca.properties.html">vacca.properties module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../vacca.synoptics.html">vacca.synoptics module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../vacca.tree.html">vacca.tree module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../vacca.alarms.html">vacca.alarms module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../vacca.grid.html">vacca.grid module</a></li>
</ul>

          <h3 style="margin-top: 1.5em;">Search</h3>
          <form class="search" action="../../search.html" method="get">
            <input type="text" name="q" />
            <input type="submit" value="Go" />
            <input type="hidden" name="check_keywords" value="yes" />
            <input type="hidden" name="area" value="default" />
          </form>
          <p class="searchtip" style="font-size: 90%">
            Enter search terms or a module, class or function name.
          </p>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

    <div class="footer-wrapper">
      <div class="footer">
        <div class="left">
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |
          <a href="../../genindex.html" title="General Index"
             >index</a>
        </div>

        <div class="right">
          
    <div class="footer">
        &copy; Copyright 2015, Author.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

  </body>
</html>